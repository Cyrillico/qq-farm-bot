<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QQ 农场 Web 控制台</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="bg-glow bg-glow-a"></div>
  <div class="bg-glow bg-glow-b"></div>
  <main class="page">
    <header class="hero">
      <div class="hero-row">
        <h1>QQ 农场 Web 控制台</h1>
        <button id="logoutBtn" class="btn hidden" type="button">退出登录</button>
      </div>
      <p id="serverMeta">准备连接...</p>
    </header>

    <section id="authPanel" class="panel auth-panel hidden">
      <h2>控制台登录</h2>
      <div class="grid two">
        <label>
          账号
          <input id="authUsername" type="text" autocomplete="username" />
        </label>
        <label>
          密码
          <input id="authPassword" type="password" autocomplete="current-password" />
        </label>
      </div>
      <div class="actions">
        <button id="loginBtn" class="btn btn-primary" type="button">登录</button>
      </div>
      <p id="authStatus" class="status-line"></p>
    </section>

    <section class="panel control-panel">
      <h2>启动控制</h2>
      <div class="grid two">
        <label>
          账号标识（accountId）
          <input id="accountId" type="text" placeholder="例如 qq-main / wx-1" />
        </label>
        <label>
          日志视图
          <select id="logScope">
            <option value="selected">仅当前账号</option>
            <option value="all">全部账号</option>
          </select>
        </label>
      </div>
      <div class="grid two">
        <label>
          模式
          <select id="mode">
            <option value="run">运行</option>
            <option value="verify">验证 proto</option>
            <option value="decode">PB 解码</option>
          </select>
        </label>
        <label>
          平台
          <select id="platform">
            <option value="qq">QQ</option>
            <option value="wx">微信</option>
          </select>
        </label>
      </div>

      <div id="runFields" class="stack">
        <div class="grid two">
          <label>
            code
            <input id="code" type="text" placeholder="可留空并勾选QQ扫码" />
          </label>
          <label class="checkbox">
            <input id="useQr" type="checkbox" />
            <span>QQ 扫码登录（无 code 时）</span>
          </label>
        </div>
        <div class="grid two">
          <label>
            农场间隔（秒）
            <input id="interval" type="number" min="1" step="1" placeholder="例如 10" />
          </label>
          <label>
            好友间隔（秒）
            <input id="friendInterval" type="number" min="1" step="1" placeholder="例如 2" />
          </label>
        </div>
      </div>

      <div id="decodeFields" class="stack hidden">
        <label>
          decode 数据
          <textarea id="decodeData" rows="3" placeholder="输入 base64 或 hex"></textarea>
        </label>
        <div class="grid three">
          <label class="checkbox"><input id="decodeHex" type="checkbox" /><span>--hex</span></label>
          <label class="checkbox"><input id="decodeGate" type="checkbox" /><span>--gate</span></label>
          <label>
            type
            <input id="decodeType" type="text" placeholder="可选，例如 gatepb.Message" />
          </label>
        </div>
      </div>

      <div class="actions">
        <button id="startBtn" class="btn btn-primary">启动</button>
        <button id="stopBtn" class="btn btn-danger">停止</button>
        <button id="clearLogsBtn" class="btn">清空日志</button>
      </div>
      <p id="sessionStatus" class="status-line">状态：idle</p>
      <div id="sessionList" class="session-list"></div>
    </section>

    <section class="panel metrics">
      <h2>实时信息</h2>
      <div class="cards">
        <article class="card">
          <h3>账号状态</h3>
          <p id="metricPlatform">平台：-</p>
          <p id="metricName">昵称：-</p>
          <p id="metricLevel">等级：-</p>
          <p id="metricExp">经验：-</p>
          <p id="metricExpToNext">升级还差：-</p>
          <p id="metricGold">金币：-</p>
        </article>
        <article class="card">
          <h3>最佳作物</h3>
          <p id="bestCropName">当前选种：-</p>
          <p id="bestCropCurrent">当前等级最优：-</p>
          <p id="bestCropNext">下一级最优：-</p>
          <p id="bestCropExp">当前等级最优效率：-</p>
          <p id="bestCropSource">来源：-</p>
        </article>
        <article class="card">
          <h3>QQ 扫码</h3>
          <p id="qrPhase">状态：-</p>
          <img id="qrImage" class="qr-image hidden" alt="QQ扫码二维码" />
          <a id="qrLink" class="hidden" target="_blank" rel="noreferrer">打开扫码链接</a>
          <p id="qrMessage"></p>
        </article>
      </div>
    </section>

    <section class="panel bark-panel">
      <h2>Bark 设置</h2>
      <div class="grid two">
        <label class="checkbox">
          <input id="barkEnabled" type="checkbox" />
          <span>启用 Bark 推送</span>
        </label>
        <label>
          通知分组
          <input id="barkGroup" type="text" />
        </label>
      </div>
      <label>
        Bark 链接
        <input id="barkPushUrl" type="text" placeholder="https://api.day.app/your-key/" />
      </label>
      <div class="grid two">
        <label>
          去重秒数（0-3600）
          <input id="barkDedupSeconds" type="number" min="0" max="3600" step="1" />
        </label>
        <div>
          <p class="mini-title">通知分类</p>
          <div class="grid three">
            <label class="checkbox"><input id="catFatal" type="checkbox" /><span>fatal</span></label>
            <label class="checkbox"><input id="catNetwork" type="checkbox" /><span>network</span></label>
            <label class="checkbox"><input id="catBusiness" type="checkbox" /><span>business</span></label>
          </div>
        </div>
      </div>
      <div class="actions">
        <button id="saveBarkBtn" class="btn btn-primary">保存 Bark 设置</button>
        <button id="testBarkBtn" class="btn">测试推送</button>
      </div>
      <p id="barkStatus" class="status-line"></p>
    </section>

    <section class="panel logs-panel">
      <h2>实时日志</h2>
      <pre id="logs"></pre>
    </section>
  </main>

  <script src="/app.js"></script>
</body>
</html>
